<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>資料科學與R語言</title>
  <meta name="description" content="介紹如何使用R語言完成資料讀取、處理、分析與呈現，以及大數據技術與R的整合">
  <meta name="generator" content="bookdown 0.3.9 and GitBook 2.6.7">

  <meta property="og:title" content="資料科學與R語言" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://yijutseng.github.io/DataScienceRBook" />
  
  <meta property="og:description" content="介紹如何使用R語言完成資料讀取、處理、分析與呈現，以及大數據技術與R的整合" />
  <meta name="github-repo" content="yijutseng/DataAnalyticsWithRBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="資料科學與R語言" />
  
  <meta name="twitter:description" content="介紹如何使用R語言完成資料讀取、處理、分析與呈現，以及大數據技術與R的整合" />
  

<meta name="author" content="曾意儒 Yi-Ju Tseng">


<meta name="date" content="2017-03-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="function.html">
<link rel="next" href="manipulation.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/detect-resize/jquery.resize.js"></script>
<link href="libs/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
<script src="libs/jquery-ui/jquery-ui.min.js"></script>
<script src="libs/d3/d3.min.js"></script>
<script src="libs/vega/vega.min.js"></script>
<script src="libs/lodash/lodash.min.js"></script>
<script>var lodash = _.noConflict();</script>
<link href="libs/ggvis/css/ggvis.css" rel="stylesheet" />
<script src="libs/ggvis/js/ggvis.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/plotlyjs/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs/plotly-latest.min.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2407708-3', 'auto');
ga('send', 'pageview');

</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">資料科學與R語言</a></li>

<li class="divider"></li>
<li><a href="index.html#preface"></a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R語言101</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.1</b> 什麼是R語言</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 函數使用</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 變數設定</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 執行視窗</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#DataType"><i class="fa fa-check"></i><b>1.5</b> 資料型態</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#-numeric"><i class="fa fa-check"></i><b>1.5.1</b> 數值 numeric</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#-character"><i class="fa fa-check"></i><b>1.5.2</b> 字串 character</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#-logic"><i class="fa fa-check"></i><b>1.5.3</b> 布林變數 logic</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#-date"><i class="fa fa-check"></i><b>1.5.4</b> 日期 (Date)</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#section-1.6"><i class="fa fa-check"></i><b>1.6</b> 基本運算子</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#section-1.6.1"><i class="fa fa-check"></i><b>1.6.1</b> 數學基本運算</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#section-1.6.2"><i class="fa fa-check"></i><b>1.6.2</b> 進階數學函數</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#section-1.6.3"><i class="fa fa-check"></i><b>1.6.3</b> 邏輯運算</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#section-1.7"><i class="fa fa-check"></i><b>1.7</b> 錯誤訊息</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#help"><i class="fa fa-check"></i><b>1.8</b> Help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RDataStructure.html"><a href="RDataStructure.html"><i class="fa fa-check"></i><b>2</b> R 資料結構</a><ul>
<li class="chapter" data-level="2.1" data-path="RDataStructure.html"><a href="RDataStructure.html#-vector"><i class="fa fa-check"></i><b>2.1</b> 向量 vector</a><ul>
<li class="chapter" data-level="2.1.1" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.1.1"><i class="fa fa-check"></i><b>2.1.1</b> 快速產生向量函數</a></li>
<li class="chapter" data-level="2.1.2" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.1.2"><i class="fa fa-check"></i><b>2.1.2</b> 向量運算</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="RDataStructure.html"><a href="RDataStructure.html#-factor"><i class="fa fa-check"></i><b>2.2</b> 因子 factor</a></li>
<li class="chapter" data-level="2.3" data-path="RDataStructure.html"><a href="RDataStructure.html#-list"><i class="fa fa-check"></i><b>2.3</b> 列表 list</a><ul>
<li class="chapter" data-level="2.3.1" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.3.1"><i class="fa fa-check"></i><b>2.3.1</b> 列表資料擷取</a></li>
<li class="chapter" data-level="2.3.2" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.3.2"><i class="fa fa-check"></i><b>2.3.2</b> 列表資料編輯設定</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="RDataStructure.html"><a href="RDataStructure.html#-matrix"><i class="fa fa-check"></i><b>2.4</b> 矩陣 matrix</a></li>
<li class="chapter" data-level="2.5" data-path="RDataStructure.html"><a href="RDataStructure.html#-data.frame"><i class="fa fa-check"></i><b>2.5</b> 資料框 data.frame</a></li>
<li class="chapter" data-level="2.6" data-path="RDataStructure.html"><a href="RDataStructure.html#-data.table"><i class="fa fa-check"></i><b>2.6</b> 資料表 data.table</a></li>
<li class="chapter" data-level="2.7" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.7"><i class="fa fa-check"></i><b>2.7</b> 資料屬性查詢函數</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="controlstructure.html"><a href="controlstructure.html"><i class="fa fa-check"></i><b>3</b> 控制流程</a><ul>
<li class="chapter" data-level="3.1" data-path="controlstructure.html"><a href="controlstructure.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 條件判斷</a><ul>
<li class="chapter" data-level="3.1.1" data-path="controlstructure.html"><a href="controlstructure.html#if-else"><i class="fa fa-check"></i><b>3.1.1</b> if-else敘述</a></li>
<li class="chapter" data-level="3.1.2" data-path="controlstructure.html"><a href="controlstructure.html#if-else-if-else"><i class="fa fa-check"></i><b>3.1.2</b> if-else if-else</a></li>
<li class="chapter" data-level="3.1.3" data-path="controlstructure.html"><a href="controlstructure.html#if"><i class="fa fa-check"></i><b>3.1.3</b> 巢狀if</a></li>
<li class="chapter" data-level="3.1.4" data-path="controlstructure.html"><a href="controlstructure.html#ifelse"><i class="fa fa-check"></i><b>3.1.4</b> ifelse()</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="controlstructure.html"><a href="controlstructure.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 迴圈</a><ul>
<li class="chapter" data-level="3.2.1" data-path="controlstructure.html"><a href="controlstructure.html#for"><i class="fa fa-check"></i><b>3.2.1</b> for</a></li>
<li class="chapter" data-level="3.2.2" data-path="controlstructure.html"><a href="controlstructure.html#while"><i class="fa fa-check"></i><b>3.2.2</b> while</a></li>
<li class="chapter" data-level="3.2.3" data-path="controlstructure.html"><a href="controlstructure.html#break"><i class="fa fa-check"></i><b>3.2.3</b> break</a></li>
<li class="chapter" data-level="3.2.4" data-path="controlstructure.html"><a href="controlstructure.html#next"><i class="fa fa-check"></i><b>3.2.4</b> next</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="controlstructure.html"><a href="controlstructure.html#purrr"><i class="fa fa-check"></i><b>3.3</b> purrr</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="function.html"><a href="function.html"><i class="fa fa-check"></i><b>4</b> 函數</a></li>
<li class="chapter" data-level="5" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>5</b> 資料讀取與匯出</a><ul>
<li class="chapter" data-level="5.1" data-path="io.html"><a href="io.html#file"><i class="fa fa-check"></i><b>5.1</b> 從檔案匯入基本資料格式</a><ul>
<li class="chapter" data-level="5.1.1" data-path="io.html"><a href="io.html#import-dataset-rstudio"><i class="fa fa-check"></i><b>5.1.1</b> Import Dataset功能 (RStudio)</a></li>
<li class="chapter" data-level="5.1.2" data-path="io.html"><a href="io.html#-.txt"><i class="fa fa-check"></i><b>5.1.2</b> 分隔文字檔 .txt</a></li>
<li class="chapter" data-level="5.1.3" data-path="io.html"><a href="io.html#csv"><i class="fa fa-check"></i><b>5.1.3</b> CSV檔案 .csv</a></li>
<li class="chapter" data-level="5.1.4" data-path="io.html"><a href="io.html#excel-.xls"><i class="fa fa-check"></i><b>5.1.4</b> Excel檔案 .xls</a></li>
<li class="chapter" data-level="5.1.5" data-path="io.html"><a href="io.html#r-.rds"><i class="fa fa-check"></i><b>5.1.5</b> R物件 .rds</a></li>
<li class="chapter" data-level="5.1.6" data-path="io.html"><a href="io.html#r-.r"><i class="fa fa-check"></i><b>5.1.6</b> R程式 .R</a></li>
<li class="chapter" data-level="5.1.7" data-path="io.html"><a href="io.html#-"><i class="fa fa-check"></i><b>5.1.7</b> 純文字資料 (無分隔)</a></li>
<li class="chapter" data-level="5.1.8" data-path="io.html"><a href="io.html#section-5.1.8"><i class="fa fa-check"></i><b>5.1.8</b> 其他格式</a></li>
<li class="chapter" data-level="5.1.9" data-path="io.html"><a href="io.html#section-5.1.9"><i class="fa fa-check"></i><b>5.1.9</b> 其他讀檔注意事項</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="io.html"><a href="io.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 從網路匯入資料</a><ul>
<li class="chapter" data-level="5.2.1" data-path="io.html"><a href="io.html#open-data"><i class="fa fa-check"></i><b>5.2.1</b> Open Data</a></li>
<li class="chapter" data-level="5.2.2" data-path="io.html"><a href="io.html#api"><i class="fa fa-check"></i><b>5.2.2</b> API (Application programming interfaces)</a></li>
<li class="chapter" data-level="5.2.3" data-path="io.html"><a href="io.html#json"><i class="fa fa-check"></i><b>5.2.3</b> JSON格式檔案</a></li>
<li class="chapter" data-level="5.2.4" data-path="io.html"><a href="io.html#xml"><i class="fa fa-check"></i><b>5.2.4</b> XML 可延伸標記式語言</a></li>
<li class="chapter" data-level="5.2.5" data-path="io.html"><a href="io.html#-webscraping"><i class="fa fa-check"></i><b>5.2.5</b> 網頁爬蟲 Webscraping</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="io.html"><a href="io.html#facebook"><i class="fa fa-check"></i><b>5.3</b> Facebook資料擷取</a><ul>
<li class="chapter" data-level="5.3.1" data-path="io.html"><a href="io.html#graph-api-in-r"><i class="fa fa-check"></i><b>5.3.1</b> Graph API in R</a></li>
<li class="chapter" data-level="5.3.2" data-path="io.html"><a href="io.html#rfacebook-package"><i class="fa fa-check"></i><b>5.3.2</b> Rfacebook package</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="io.html"><a href="io.html#section-5.4"><i class="fa fa-check"></i><b>5.4</b> 資料匯出</a><ul>
<li class="chapter" data-level="5.4.1" data-path="io.html"><a href="io.html#-.txt"><i class="fa fa-check"></i><b>5.4.1</b> 文字檔 .txt</a></li>
<li class="chapter" data-level="5.4.2" data-path="io.html"><a href="io.html#csv-.csv"><i class="fa fa-check"></i><b>5.4.2</b> CSV檔 .csv</a></li>
<li class="chapter" data-level="5.4.3" data-path="io.html"><a href="io.html#r-.rds-1"><i class="fa fa-check"></i><b>5.4.3</b> R物件 .rds</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manipulation.html"><a href="manipulation.html"><i class="fa fa-check"></i><b>6</b> 資料處理與清洗</a><ul>
<li class="chapter" data-level="6.1" data-path="manipulation.html"><a href="manipulation.html#tidy-data"><i class="fa fa-check"></i><b>6.1</b> Tidy Data</a></li>
<li class="chapter" data-level="6.2" data-path="manipulation.html"><a href="manipulation.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 資料型別轉換處理</a><ul>
<li class="chapter" data-level="6.2.1" data-path="manipulation.html"><a href="manipulation.html#section-6.2.1"><i class="fa fa-check"></i><b>6.2.1</b> 資料型別檢查</a></li>
<li class="chapter" data-level="6.2.2" data-path="manipulation.html"><a href="manipulation.html#section-6.2.2"><i class="fa fa-check"></i><b>6.2.2</b> 資料型別轉換</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="manipulation.html"><a href="manipulation.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 文字字串處理</a><ul>
<li class="chapter" data-level="6.3.1" data-path="manipulation.html"><a href="manipulation.html#section-6.3.1"><i class="fa fa-check"></i><b>6.3.1</b> 基本處理</a></li>
<li class="chapter" data-level="6.3.2" data-path="manipulation.html"><a href="manipulation.html#section-6.3.2"><i class="fa fa-check"></i><b>6.3.2</b> 搜尋字串</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="manipulation.html"><a href="manipulation.html#subset"><i class="fa fa-check"></i><b>6.4</b> 子集Subset</a><ul>
<li class="chapter" data-level="6.4.1" data-path="io.html"><a href="io.html#-"><i class="fa fa-check"></i><b>6.4.1</b> 一維資料 (向量)</a></li>
<li class="chapter" data-level="6.4.2" data-path="manipulation.html"><a href="manipulation.html#section-6.4.2"><i class="fa fa-check"></i><b>6.4.2</b> 二維資料</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="manipulation.html"><a href="manipulation.html#section-6.5"><i class="fa fa-check"></i><b>6.5</b> 排序</a><ul>
<li class="chapter" data-level="6.5.1" data-path="manipulation.html"><a href="manipulation.html#sort-"><i class="fa fa-check"></i><b>6.5.1</b> sort 向量排序</a></li>
<li class="chapter" data-level="6.5.2" data-path="manipulation.html"><a href="manipulation.html#order"><i class="fa fa-check"></i><b>6.5.2</b> order</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="manipulation.html"><a href="manipulation.html#section-6.6"><i class="fa fa-check"></i><b>6.6</b> 資料組合</a></li>
<li class="chapter" data-level="6.7" data-path="manipulation.html"><a href="manipulation.html#reshape"><i class="fa fa-check"></i><b>6.7</b> 長表與寬表</a></li>
<li class="chapter" data-level="6.8" data-path="manipulation.html"><a href="manipulation.html#section-6.8"><i class="fa fa-check"></i><b>6.8</b> 遺漏值處理</a></li>
<li class="chapter" data-level="6.9" data-path="manipulation.html"><a href="manipulation.html#manCase"><i class="fa fa-check"></i><b>6.9</b> 綜合練習範例Case study</a><ul>
<li class="chapter" data-level="6.9.1" data-path="manipulation.html"><a href="manipulation.html#section-6.9.1"><i class="fa fa-check"></i><b>6.9.1</b> 載入資料</a></li>
<li class="chapter" data-level="6.9.2" data-path="manipulation.html"><a href="manipulation.html#section-6.9.2"><i class="fa fa-check"></i><b>6.9.2</b> 資料總覽</a></li>
<li class="chapter" data-level="6.9.3" data-path="manipulation.html"><a href="manipulation.html#section-6.9.3"><i class="fa fa-check"></i><b>6.9.3</b> 資料排序後篩選</a></li>
<li class="chapter" data-level="6.9.4" data-path="manipulation.html"><a href="manipulation.html#section-6.9.4"><i class="fa fa-check"></i><b>6.9.4</b> 欄位值篩選</a></li>
<li class="chapter" data-level="6.9.5" data-path="manipulation.html"><a href="manipulation.html#section-6.9.5"><i class="fa fa-check"></i><b>6.9.5</b> 字串條件搜尋後篩選</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>7</b> 探索式資料分析</a><ul>
<li class="chapter" data-level="7.1" data-path="eda.html"><a href="eda.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 什麼是探索式資料分析</a></li>
<li class="chapter" data-level="7.2" data-path="eda.html"><a href="eda.html#datatable"><i class="fa fa-check"></i><b>7.2</b> data.table</a><ul>
<li class="chapter" data-level="7.2.1" data-path="eda.html"><a href="eda.html#i-"><i class="fa fa-check"></i><b>7.2.1</b> i 觀察值篩選邏輯</a></li>
<li class="chapter" data-level="7.2.2" data-path="eda.html"><a href="eda.html#j-"><i class="fa fa-check"></i><b>7.2.2</b> j 欄位選擇運算</a></li>
<li class="chapter" data-level="7.2.3" data-path="eda.html"><a href="eda.html#by-"><i class="fa fa-check"></i><b>7.2.3</b> by 分組依據</a></li>
<li class="chapter" data-level="7.2.4" data-path="eda.html"><a href="eda.html#section-7.2.4"><i class="fa fa-check"></i><b>7.2.4</b> 參考文件與資源</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="eda.html"><a href="eda.html#dplyr"><i class="fa fa-check"></i><b>7.3</b> dplyr</a><ul>
<li class="chapter" data-level="7.3.1" data-path="eda.html"><a href="eda.html#select"><i class="fa fa-check"></i><b>7.3.1</b> select()</a></li>
<li class="chapter" data-level="7.3.2" data-path="eda.html"><a href="eda.html#filter"><i class="fa fa-check"></i><b>7.3.2</b> filter()</a></li>
<li class="chapter" data-level="7.3.3" data-path="eda.html"><a href="eda.html#mutate"><i class="fa fa-check"></i><b>7.3.3</b> mutate()</a></li>
<li class="chapter" data-level="7.3.4" data-path="eda.html"><a href="eda.html#summarise"><i class="fa fa-check"></i><b>7.3.4</b> summarise()</a></li>
<li class="chapter" data-level="7.3.5" data-path="eda.html"><a href="eda.html#group_by"><i class="fa fa-check"></i><b>7.3.5</b> group_by()</a></li>
<li class="chapter" data-level="7.3.6" data-path="eda.html"><a href="eda.html#arrange"><i class="fa fa-check"></i><b>7.3.6</b> arrange()</a></li>
<li class="chapter" data-level="7.3.7" data-path="eda.html"><a href="eda.html#rename"><i class="fa fa-check"></i><b>7.3.7</b> rename()</a></li>
<li class="chapter" data-level="7.3.8" data-path="eda.html"><a href="eda.html#-1"><i class="fa fa-check"></i><b>7.3.8</b> 參考文件與資源</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>8</b> 資料視覺化</a><ul>
<li class="chapter" data-level="8.1" data-path="vis.html"><a href="vis.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> 資料視覺化的目的</a></li>
<li class="chapter" data-level="8.2" data-path="vis.html"><a href="vis.html#ggplot2"><i class="fa fa-check"></i><b>8.2</b> ggplot2簡介</a><ul>
<li class="chapter" data-level="8.2.1" data-path="vis.html"><a href="vis.html#qplot"><i class="fa fa-check"></i><b>8.2.1</b> qplot()</a></li>
<li class="chapter" data-level="8.2.2" data-path="vis.html"><a href="vis.html#ggplot"><i class="fa fa-check"></i><b>8.2.2</b> ggplot()</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="vis.html"><a href="vis.html#ggplot2"><i class="fa fa-check"></i><b>8.3</b> ggplot2+地圖</a><ul>
<li class="chapter" data-level="8.3.1" data-path="vis.html"><a href="vis.html#choropleth-map"><i class="fa fa-check"></i><b>8.3.1</b> Choropleth map面量圖</a></li>
<li class="chapter" data-level="8.3.2" data-path="vis.html"><a href="vis.html#ggmap"><i class="fa fa-check"></i><b>8.3.2</b> ggmap()</a></li>
<li class="chapter" data-level="8.3.3" data-path="vis.html"><a href="vis.html#density-map"><i class="fa fa-check"></i><b>8.3.3</b> Density Map</a></li>
<li class="chapter" data-level="8.3.4" data-path="vis.html"><a href="vis.html#section-8.3.4"><i class="fa fa-check"></i><b>8.3.4</b> 參考資料</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="vis.html"><a href="vis.html#taiwan"><i class="fa fa-check"></i><b>8.4</b> Taiwan的面量圖</a><ul>
<li class="chapter" data-level="8.4.1" data-path="vis.html"><a href="vis.html#ggmap"><i class="fa fa-check"></i><b>8.4.1</b> ggmap+面量圖</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="vis.html"><a href="vis.html#heatmap"><i class="fa fa-check"></i><b>8.5</b> Heatmap</a></li>
<li class="chapter" data-level="8.6" data-path="vis.html"><a href="vis.html#treemap"><i class="fa fa-check"></i><b>8.6</b> Treemap</a></li>
<li class="chapter" data-level="8.7" data-path="vis.html"><a href="vis.html#-2"><i class="fa fa-check"></i><b>8.7</b> 參考文件與資源</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html"><i class="fa fa-check"></i><b>9</b> 互動式資料呈現</a><ul>
<li class="chapter" data-level="9.1" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html#ggvis"><i class="fa fa-check"></i><b>9.1</b> ggvis</a></li>
<li class="chapter" data-level="9.2" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html#googlevis"><i class="fa fa-check"></i><b>9.2</b> googleVis</a></li>
<li class="chapter" data-level="9.3" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html#plot.ly"><i class="fa fa-check"></i><b>9.3</b> Plot.ly</a></li>
<li class="chapter" data-level="9.4" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html#shiny"><i class="fa fa-check"></i><b>9.4</b> Shiny簡介</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datamining.html"><a href="datamining.html"><i class="fa fa-check"></i><b>10</b> 資料探勘</a><ul>
<li class="chapter" data-level="10.1" data-path="datamining.html"><a href="datamining.html#section-10.1"><i class="fa fa-check"></i><b>10.1</b> 什麼是資料探勘</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big.html"><a href="big.html"><i class="fa fa-check"></i><b>11</b> 從小數據到大數據分析</a><ul>
<li class="chapter" data-level="11.1" data-path="big.html"><a href="big.html#r-hadoop"><i class="fa fa-check"></i><b>11.1</b> R + Hadoop</a></li>
<li class="chapter" data-level="11.2" data-path="big.html"><a href="big.html#rhadoop-cloudera"><i class="fa fa-check"></i><b>11.2</b> RHadoop安裝測試流程 (Cloudera)</a><ul>
<li class="chapter" data-level="11.2.1" data-path="big.html"><a href="big.html#section-11.2.1"><i class="fa fa-check"></i><b>11.2.1</b> 系統/軟體版本資訊</a></li>
<li class="chapter" data-level="11.2.2" data-path="eda.html"><a href="eda.html#-1"><i class="fa fa-check"></i><b>11.2.2</b> 參考資料</a></li>
<li class="chapter" data-level="11.2.3" data-path="big.html"><a href="big.html#section-11.2.3"><i class="fa fa-check"></i><b>11.2.3</b> 安裝步驟</a></li>
<li class="chapter" data-level="11.2.4" data-path="big.html"><a href="big.html#section-11.2.4"><i class="fa fa-check"></i><b>11.2.4</b> 測試前，先解決權限問題</a></li>
<li class="chapter" data-level="11.2.5" data-path="big.html"><a href="big.html#section-11.2.5"><i class="fa fa-check"></i><b>11.2.5</b> 測試</a></li>
<li class="chapter" data-level="11.2.6" data-path="big.html"><a href="big.html#rstudio-server"><i class="fa fa-check"></i><b>11.2.6</b> 安裝RStudio Server</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="big.html"><a href="big.html#rhadoop-mapreduce-easy-word-count"><i class="fa fa-check"></i><b>11.3</b> RHadoop MapReduce: easy word count</a></li>
<li class="chapter" data-level="11.4" data-path="big.html"><a href="big.html#r-spark"><i class="fa fa-check"></i><b>11.4</b> R + Spark</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>12</b> 軟體安裝介紹</a><ul>
<li class="chapter" data-level="12.1" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>12.1</b> R安裝</a></li>
<li class="chapter" data-level="12.2" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>12.2</b> RStudio安裝</a></li>
<li class="chapter" data-level="12.3" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>12.3</b> RStudio使用簡介</a><ul>
<li class="chapter" data-level="12.3.1" data-path="install.html"><a href="install.html#section-12.3.1"><i class="fa fa-check"></i><b>12.3.1</b> 專案</a></li>
<li class="chapter" data-level="12.3.2" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>12.3.2</b> RStudio介面</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者資訊</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">資料科學與R語言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="io" class="section level1">
<h1><span class="header-section-number">5</span> 資料讀取與匯出</h1>
<p>資料(Data)在<a href="http://en.wikipedia.org/wiki/Data" target="_blank">維基百科</a>的定義是<code>values of qualitative or quantitative variables, belonging to a set of items.</code>，一般來說，在資料分析前會經過多個步驟，包括<strong>資料匯入</strong>Chapter <a href="io.html#io">5</a>、<strong>資料清洗處理</strong>Chapter <a href="manipulation.html#manipulation">6</a>並轉換為Tidy data、<strong>資料分析</strong>Chapter <a href="eda.html#eda">7</a>、<strong>資料呈現與視覺化</strong>Chapter <a href="vis.html#vis">8</a>。</p>
<p>資料有多種可能來源，包括:</p>
<ul>
<li>硬碟</li>
<li>網路下載</li>
<li>Open Data (API)</li>
<li>網頁裡 (爬蟲！)</li>
<li>任何地方</li>
</ul>
<p>以下介紹由檔案、網路等來源匯入多種資料格式的匯入方式，以及建議的資料匯出方法。</p>
<div id="file" class="section level2">
<h2><span class="header-section-number">5.1</span> 從檔案匯入基本資料格式</h2>
<div id="import-dataset-rstudio" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Import Dataset功能 (RStudio)</h3>
<p><a href="https://www.rstudio.com/" target="_blank">RStudio</a> 1.0版後即提供很好的資料匯入介面，使用者可以不用撰寫任何程式碼，就能完成<code>.csv</code>、<code>Excel</code>以及<code>SAS</code>等檔案匯入。首先選取RStudio四分割視窗右上角的Environment標籤，選擇<strong>Import Dataset</strong>，就會出現檔案格式的選項</p>
<p><img src="figure/import.png" width="592" /></p>
<p>以csv檔案為例，在選單中選取<code>From CSV</code>，選取後會跳出資料匯入輔助視窗，點選<code>Browse</code>按鈕開啟檔案選取器，並點選欲匯入之文字檔案</p>
<p><img src="figure/csv.png" width="497" /></p>
<p>檔案選取後，資料匯入輔助視窗有預覽功能，供使用者檢查資料匯入方法是否正確，若需調整各項參數，可利用下方<code>Import Options</code>的選項微調，最常用的調整功能是<code>Delimiter</code>分隔符號與<code>First Row as Names</code>首列是否為欄位名稱。</p>
<p><img src="figure/csv2.png" width="960" /></p>
<p>如果要匯入的檔案為<strong>tab分隔文字檔</strong>，一樣可以選擇<code>.csv</code>選項，再修改<code>Delimiter</code>參數為<code>Tab</code>即可。</p>
<p>資料匯入輔助視窗右下方<code>Code Preview:</code>子視窗中會自動產生資料匯入程式碼，如果未來想再使用視窗匯入，希望透過程式碼匯入，可以將此段程式碼複製貼上到R程式碼檔案(.R)，供後續分析使用。</p>
</div>
<div id="-.txt" class="section level3">
<h3><span class="header-section-number">5.1.2</span> 分隔文字檔 .txt</h3>
<p><code>readr</code> <span class="citation">(Wickham, Hester, and Francois <a href="#ref-R-readr">2016</a>)</span> package提供完整的文字檔讀取功能，各讀取函數的第一個參數通常為<strong>檔案路徑與名稱</strong>，<code>read_delim()</code>函數可用來讀取所有用分隔符號分隔的文字檔案，以tab分隔為例，只需將<code>delim</code>參數設定為<code>\t</code>，即可用tab將各欄位分開讀取。此外，<code>col_names</code>參數也常被使用，TRUE代表資料內有包含欄位名稱(通常在首列)，預設為TRUE，如果設定為FALSE，欄位名稱則會依順序被設定為 X1, X2, X3 …。</p>
<p>參數整理如下 (可用?read_delim指令閱讀官方說明)：</p>
<ul>
<li><code>file</code>, 檔名</li>
<li><code>delim</code>, 分隔符號</li>
<li><code>quote</code>, 把欄位包起來的符號</li>
<li><code>escape_backslash</code>, 預設FALSE，是否用/作為逃脫符號</li>
<li><code>escape_double</code>, 預設TRUE，是否用quote符號作為逃脫符號</li>
<li><code>col_names</code>, 是否有欄位名稱（表頭）（T/F）</li>
<li><code>col_types</code>, 每一個欄位的類別，用向量表示</li>
<li><code>comment</code>, 備註標示符號，在備註標示符號之後的文字不會被讀入</li>
<li><code>skip</code>, 要跳過幾行？</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
dataset &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;檔案路徑與名稱&quot;</span>, <span class="dt">delim=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre></div>
</div>
<div id="csv" class="section level3">
<h3><span class="header-section-number">5.1.3</span> CSV檔案 .csv</h3>
<p><code>readr</code> <span class="citation">(Wickham, Hester, and Francois <a href="#ref-R-readr">2016</a>)</span> package也提供CSV (逗號分隔)檔案的讀取功能，<code>read_csv()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
dataset &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;檔案路徑與名稱&quot;</span>)</code></pre></div>
</div>
<div id="excel-.xls" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Excel檔案 .xls</h3>
<p><code>readxl</code> <span class="citation">(Wickham <a href="#ref-R-readxl">2016</a><a href="#ref-R-readxl">a</a>)</span> package提供讀取Excel檔案 (xls, xlsx)的函數<code>read_excel()</code>，除了常用的<code>col_names</code>參數外，也可使用<code>sheet</code>參數設定要讀取的工作表(sheet)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
dataset &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;檔案路徑與名稱&quot;</span>)</code></pre></div>
</div>
<div id="r-.rds" class="section level3">
<h3><span class="header-section-number">5.1.5</span> R物件 .rds</h3>
<p>R物件有檔案小與讀取快速的優點，如果在R程式處理資料後必須儲存一份以供後續分析的話，使用R物件儲存是最佳的方式，讀取R物件有多種函數可供選擇，推薦使用<code>readRDS()</code>函數 (參考資料:<a href="http://www.fromthebottomoftheheap.net/2012/04/01/saving-and-loading-r-objects/" target="_blank">A better way of saving and loading objects in R</a>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;檔案路徑與名稱&quot;</span>)</code></pre></div>
</div>
<div id="r-.r" class="section level3">
<h3><span class="header-section-number">5.1.6</span> R程式 .R</h3>
<p><code>source</code>, 讀R的Obejct or script, 執行, ASCII (<code>dump</code>的相反)</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">5.1.7</span> 純文字資料 (無分隔)</h3>
<p><code>readLines</code>, 逐行讀取文字資料</p>
</div>
<div id="section-5.1.8" class="section level3">
<h3><span class="header-section-number">5.1.8</span> 其他格式</h3>
<p>透過載入套件，R可讀入許多其他格式的檔案:</p>
<ul>
<li>MySQL <code>RMySQL</code></li>
<li>HDF5 <code>rhdf5</code></li>
<li>Weka <code>foreign</code></li>
<li>Stata <code>foreign</code></li>
<li>SPSS <code>Hmisc</code></li>
<li>SAS <code>Hmisc</code></li>
<li>GIS <code>rgdal</code></li>
<li>Images <code>jpeg</code></li>
<li>Music <code>tuneR</code></li>
</ul>
</div>
<div id="section-5.1.9" class="section level3">
<h3><span class="header-section-number">5.1.9</span> 其他讀檔注意事項</h3>
<p>讀檔的時候R會自動</p>
<ul>
<li>跳過#開頭的任何行（Row）</li>
<li>判斷要讀幾行</li>
<li>判斷每個列（Column）的類別</li>
<li>把欄位包起來的符號</li>
</ul>
<p>如果讀取時已指定<strong>Column類別</strong>以及<strong>把欄位包起來的符號</strong>，讀取速度會快很多。</p>
</div>
</div>
<div id="section-5.2" class="section level2">
<h2><span class="header-section-number">5.2</span> 從網路匯入資料</h2>
<div id="open-data" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Open Data</h3>
<p><strong>開放資料</strong> (Open data) 指的是一種經過挑選與許可的資料，這些資料不受著作權、專利權，以及其他管理機制所限制，可以開放給社會公眾，任何人都可以自由出版使用，不論是要拿來出版或是做其他的運用都不加以限制。Open data 運動希望達成的目標與開放原始碼、內容開放、開放獲取等其他「開放」運動類似。Open data 背後的核心思想由來已，但 Open data 這名詞直到近代才出現，拜網際網路崛起而為人所知，尤其是 Data.gov 等 Open data 政府組織的設立。(<a href="https://zh.wikipedia.org/wiki/%E9%96%8B%E6%94%BE%E8%B3%87%E6%96%99" target="_blank">維基百科</a>)</p>
<p>台灣政府從2011年開始大力推動開放政府與開放資料的概念，多個機關與縣市政府架設開放資料平台，供民眾擷取或再利用各項資料</p>
<ul>
<li><a href="http://data.gov.tw/" target="_blank">政府資料開放平台</a></li>
<li><a href="http://data.taipei/" target="_blank">Data Taipei</a></li>
<li><a href="http://data.tycg.gov.tw/" target="_blank">開放資料 x 開放桃園</a></li>
<li><a href="http://data.moi.gov.tw/" target="_blank">內政資料開放平台</a></li>
</ul>
<p>Open Data常見的儲存方式為: <code>CSV</code>Chapter <a href="io.html#csv">5.1.3</a>、<code>JSON</code>Chapter <a href="io.html#json">5.2.3</a>、<code>XML</code>Chapter <a href="io.html#xml">5.2.4</a>，開放資料網站通常有提供民眾<strong>直接下載</strong>檔案的服務，針對可下載的CSV格式資料，可以下載完成後，透過上述<strong>由檔案匯入資料</strong> Chapter <a href="io.html#file">5.1</a>方法匯入即可。</p>
</div>
<div id="api" class="section level3">
<h3><span class="header-section-number">5.2.2</span> API (Application programming interfaces)</h3>
<p>應用程式介面 Application programming interfaces (API) 通常是特定軟體、程序或系統，廠商或開發人員，為了能夠讓第三方的開發者可以額外開發應用程式來強化他們的產品，所推出可以與他們系統溝通的介面。(<a href="https://zh.wikipedia.org/zh-tw/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3" target="_blank">維基百科</a>)</p>
<p>以下載Open Data為例，若檔案更新頻繁，使用手動下載相當耗時。如<a href="http://data.taipei/opendata/datalist/datasetMeta?oid=6a3e862a-e1cb-4e44-b989-d35609559463" target="_blank">臺北市開放認養動物</a>資料，更新頻率為每日，所以許多開放資料也提供透過<strong>API</strong>下載的服務，透過API下載的資料格式會是JSON格式Chapter <a href="io.html#json">5.2.3</a>，如<a href="http://data.taipei/opendata/datalist/datasetMeta/outboundDesc?id=6a3e862a-e1cb-4e44-b989-d35609559463&amp;rid=f4a75ba9-7721-4363-884d-c3820b0b917c" target="_blank">臺北市開放認養動物API資訊</a>所示，開放資料網站會提供<strong>資料集ID</strong>與<strong>資料RID</strong></p>
<ul>
<li><strong>資料集ID</strong>: 紀錄資料的基本參數，如包含欄位、更新頻率等</li>
<li><strong>資料RID</strong>: 資料集</li>
</ul>
<p>並同時提供擷取範例，如果需要下載原始資料，可直接從範例複製貼上即可，如http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&amp;rid=f4a75ba9-7721-4363-884d-c3820b0b917c</p>
</div>
<div id="json" class="section level3">
<h3><span class="header-section-number">5.2.3</span> JSON格式檔案</h3>
<p>JSON (<strong>J</strong>ava<strong>s</strong>cript <strong>O</strong>bject <strong>N</strong>otation)是一種輕量級的資料交換語言 (<a href="http://en.wikipedia.org/wiki/JSON" target="_blank">Wiki</a>)，特色如下:</p>
<ul>
<li>from <strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterfaces (APIs)</li>
<li>JavaScript、Java、Node.js應用</li>
<li>一些NoSQL非關連型資料庫用JSON儲存資料：<strong>MongoDB</strong></li>
<li>資料儲存格式
<ul>
<li>Numbers (double)</li>
<li>Strings (double quoted)</li>
<li>Boolean (<em>true</em> or <em>false</em>)</li>
<li>Array (ordered, comma separated enclosed in square brackets <em><a href="index.html#preface"></a></em>)</li>
<li>Object (unorderd, comma separated collection of <strong>key:value</strong> pairs in curley brackets <em>{}</em>)</li>
</ul></li>
</ul>
<p><a href="https://api.github.com/users/yijutseng/repos" target="_blank">JSON檔案範例</a></p>
<p>許多Open Data也用JSON格式儲存，例如<a href="http://data.taipei/opendata/datalist/datasetMeta?oid=6a3e862a-e1cb-4e44-b989-d35609559463" target="_blank">臺北市開放認養動物</a>資料，根據資料的API資訊，可得資料擷取網址http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&amp;rid=f4a75ba9-7721-4363-884d-c3820b0b917c 。</p>
<p>將JSON檔案匯入R可以使用<code>jsonlite</code><span class="citation">(Ooms, Temple Lang, and Hilaiel <a href="#ref-R-jsonlite">2016</a>)</span> package，套件使用前必須安裝，安裝套件方法請參考Chapter <a href="intro.html#intro">1</a>，載入後，可使用<code>fromJSON()</code>函數載入JSON資料。 如需直接從API網址截取資料，需要載入<code>RCurl</code><span class="citation">(Temple Lang and CRAN team <a href="#ref-R-RCurl">2016</a>)</span> package，並使用<code>getURL()</code>函數處理資料擷取網址。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(jsonlite)
<span class="kw">library</span>(RCurl)
PetData&lt;-<span class="kw">fromJSON</span>(<span class="kw">getURL</span>(<span class="st">&quot;http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&amp;rid=f4a75ba9-7721-4363-884d-c3820b0b917c&quot;</span>))
<span class="kw">str</span>(PetData)</code></pre></div>
<pre><code>## List of 1
##  $ result:List of 5
##   ..$ offset : int 0
##   ..$ limit  : int 10000
##   ..$ count  : int 305
##   ..$ sort   : chr &quot;&quot;
##   ..$ results:&#39;data.frame&#39;:  305 obs. of  20 variables:
##   .. ..$ _id            : chr [1:305] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. ..$ Name           : chr [1:305] &quot;花俏&quot; &quot;麥茶&quot; &quot;&quot; &quot;金兒&quot; ...
##   .. ..$ Sex            : chr [1:305] &quot;雌&quot; &quot;雄&quot; &quot;雌&quot; &quot;雌&quot; ...
##   .. ..$ Type           : chr [1:305] &quot;貓&quot; &quot;貓&quot; &quot;犬&quot; &quot;貓&quot; ...
##   .. ..$ Build          : chr [1:305] &quot;中&quot; &quot;中&quot; &quot;幼&quot; &quot;中&quot; ...
##   .. ..$ Age            : chr [1:305] &quot;成年&quot; &quot;成年&quot; &quot;幼齡&quot; &quot;成年&quot; ...
##   .. ..$ Variety        : chr [1:305] &quot;米克斯&quot; &quot;米克斯&quot; &quot;米克斯&quot; &quot;米克斯&quot; ...
##   .. ..$ Reason         : chr [1:305] &quot;動物救援&quot; &quot;動物管制&quot; &quot;民眾拾獲&quot; &quot;動物管制&quot; ...
##   .. ..$ AcceptNum      : chr [1:305] &quot;106031204&quot; &quot;106031003&quot; &quot;106031021&quot; &quot;106030705&quot; ...
##   .. ..$ ChipNum        : chr [1:305] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##   .. ..$ IsSterilization: chr [1:305] &quot;未絕育&quot; &quot;未絕育&quot; &quot;未絕育&quot; &quot;未絕育&quot; ...
##   .. ..$ HairType       : chr [1:305] &quot;三花&quot; &quot;黃白&quot; &quot;黑&quot; &quot;三花&quot; ...
##   .. ..$ Note           : chr [1:305] &quot;大家好~我的名字叫花俏，漂亮的我想要找個長期飯票，這個人會是你嗎?讓我們給彼此一個機會吧!!\n&quot; &quot;大家好，我叫麥茶，\n淡淡憂鬱的我有吸引你嗎？\n個性有點緊張、怕人，\n要花時間慢慢培養感情，等待我熟悉，\n你願意給我機會，讓我進&quot;| __truncated__ &quot;&quot; &quot;你好，我叫金兒。\n個性緊張，不會靠人很近，\n因為貓咪很獨立，需要好長時間適應。\n但我還是想要在心情好的時候有人陪伴，\n你可以來&quot;| __truncated__ ...
##   .. ..$ Resettlement   : chr [1:305] &quot;臺北市動物之家 收容編號106031204&quot; &quot;臺北市動物之家 收容編號106031003&quot; &quot;臺北市動物之家 收容編號106031021&quot; &quot;臺北市動物之家 收容編號106030705&quot; ...
##   .. ..$ Phone          : chr [1:305] &quot;02-87913062&quot; &quot;02-87913062&quot; &quot;02-87913062&quot; &quot;02-87913062&quot; ...
##   .. ..$ Email          : chr [1:305] &quot;tcapoa8@mail.taipei.gov.tw&quot; &quot;tcapoa8@mail.taipei.gov.tw&quot; &quot;tcapoa8@mail.taipei.gov.tw&quot; &quot;tcapoa8@mail.taipei.gov.tw&quot; ...
##   .. ..$ ChildreAnlong  : chr [1:305] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##   .. ..$ AnimalAnlong   : chr [1:305] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##   .. ..$ Bodyweight     : chr [1:305] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##   .. ..$ ImageName      : chr [1:305] &quot;http://163.29.39.183/uploads/images/medium/e0de6dfd-332e-459b-b157-36b006a1924c.jpg&quot; &quot;http://163.29.39.183/uploads/images/medium/c5983ea5-b55a-4bd1-bb3b-2c03f8e496a2.jpg&quot; &quot;http://163.29.39.183/uploads/images/medium/c9318c07-988d-4ac4-b7ba-ddba0968759c.jpg&quot; &quot;http://163.29.39.183/uploads/images/medium/dc71f0d8-74fd-4ffb-b41d-2c4aa62a49db.jpg&quot; ...</code></pre>
<p>由資料結構可知，經過<code>fromJSON()</code>函數匯入的JSON檔案被轉存為<code>列表list</code>的型態，且在result元素中包含五個子元素(offset, limit, count, sort, results)，其中，results子元素的類別為資料框data.frame，內含開放認養動物清單，因此，可使用<code>$</code>符號截取元素與子元素</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(PetData$result$results)</code></pre></div>
<pre><code>##   _id Name Sex Type Build  Age Variety   Reason AcceptNum ChipNum
## 1   1 花俏  雌   貓    中 成年  米克斯 動物救援 106031204        
## 2   2 麥茶  雄   貓    中 成年  米克斯 動物管制 106031003        
## 3   3       雌   犬    幼 幼齡  米克斯 民眾拾獲 106031021        
## 4   4 金兒  雌   貓    中 成年  米克斯 動物管制 106030705        
## 5   5       雄   犬    大 老年  米克斯 動物管制 106030702        
## 6   6 溫蒂  雌   貓    中 成年  米克斯 動物管制 106030616        
##   IsSterilization HairType
## 1          未絕育     三花
## 2          未絕育     黃白
## 3          未絕育       黑
## 4          未絕育     三花
## 5          未絕育       黑
## 6          未絕育   虎斑白
##                                                                                                                                                                    Note
## 1                                                                            大家好~我的名字叫花俏，漂亮的我想要找個長期飯票，這個人會是你嗎?讓我們給彼此一個機會吧!!\n
## 2 大家好，我叫麥茶，\n淡淡憂鬱的我有吸引你嗎？\n個性有點緊張、怕人，\n要花時間慢慢培養感情，等待我熟悉，\n你願意給我機會，讓我進入你的家庭嗎，\n歡迎來動物之家看看我唷!
## 3                                                                                                                                                                      
## 4                               你好，我叫金兒。\n個性緊張，不會靠人很近，\n因為貓咪很獨立，需要好長時間適應。\n但我還是想要在心情好的時候有人陪伴，\n你可以來看看我嗎!
## 5                                                                                                                                                                      
## 6                                                                                                  嗨~我叫溫蒂，我想要一個溫暖安穩的家，您可以來認養我，完成我的願望嗎?
##                       Resettlement       Phone                      Email
## 1 臺北市動物之家 收容編號106031204 02-87913062 tcapoa8@mail.taipei.gov.tw
## 2 臺北市動物之家 收容編號106031003 02-87913062 tcapoa8@mail.taipei.gov.tw
## 3 臺北市動物之家 收容編號106031021 02-87913062 tcapoa8@mail.taipei.gov.tw
## 4 臺北市動物之家 收容編號106030705 02-87913062 tcapoa8@mail.taipei.gov.tw
## 5                                                                        
## 6 臺北市動物之家 收容編號106030616 02-87913062 tcapoa8@mail.taipei.gov.tw
##   ChildreAnlong AnimalAnlong Bodyweight
## 1                                      
## 2                                      
## 3                                      
## 4                                      
## 5                                      
## 6                                      
##                                                                             ImageName
## 1 http://163.29.39.183/uploads/images/medium/e0de6dfd-332e-459b-b157-36b006a1924c.jpg
## 2 http://163.29.39.183/uploads/images/medium/c5983ea5-b55a-4bd1-bb3b-2c03f8e496a2.jpg
## 3 http://163.29.39.183/uploads/images/medium/c9318c07-988d-4ac4-b7ba-ddba0968759c.jpg
## 4 http://163.29.39.183/uploads/images/medium/dc71f0d8-74fd-4ffb-b41d-2c4aa62a49db.jpg
## 5 http://163.29.39.183/uploads/images/medium/4d5c0ba3-37d0-4c5c-9f01-0d3574eb4d56.jpg
## 6 http://163.29.39.183/uploads/images/medium/2aa99d15-6ead-4824-9725-090a79844788.jpg</code></pre>
<p>results資料框中包含20個欄位，可以像分析資料框一樣，針對此資料框做分析，舉例來說，可分析各項<strong>開放認養理由</strong>出現次數</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(PetData$result$results$Reason)</code></pre></div>
<pre><code>## 
##                  動物救援     動物管制 民眾不擬續養     民眾拾獲 
##           26           94          120           44           21</code></pre>
<p>分析可知開放認養理由以動物管制與未填寫居多。</p>
<p>如果需要將資料框轉換成JSON檔案可以使用<code>jsonlite</code> package所提供的<code>toJSON()</code>函數。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myjson &lt;-<span class="st"> </span><span class="kw">toJSON</span>(iris, <span class="dt">pretty=</span><span class="ot">TRUE</span>)
<span class="kw">str</span>(myjson)</code></pre></div>
<pre><code>## Class &#39;json&#39;  chr &quot;[\n  {\n    \&quot;Sepal.Length\&quot;: 5.1,\n    \&quot;Sepal.Width\&quot;: 3.5,\n    \&quot;Petal.Length\&quot;: 1.4,\n    \&quot;Petal.Width\&quot;: 0.2\n  },\n  {\&quot;| __truncated__</code></pre>
</div>
<div id="xml" class="section level3">
<h3><span class="header-section-number">5.2.4</span> XML 可延伸標記式語言</h3>
<ul>
<li>E<strong>x</strong>tensible <strong>m</strong>arkup <strong>l</strong>anguage</li>
<li>描述<strong>結構化</strong>資料的語言</li>
<li>處理XML檔案是網頁<strong>Html</strong>爬蟲的基礎</li>
<li>Components
<ul>
<li>Markup 標記 - labels that give the text structure</li>
<li>Content 內文 - the actual text of the document</li>
</ul></li>
<li><a href="https://zh.wikipedia.org/wiki/XML" target="_blank">XML Wiki</a></li>
</ul>
<p>Tags, elements and attributes</p>
<ul>
<li>Tags correspond to general labels
<ul>
<li>Start tags <code>&lt;breakfast_menu&gt;</code>, <code>&lt;price&gt;</code></li>
<li>End tags <code>&lt;/breakfast_menu&gt;</code>,<code>&lt;/price&gt;</code></li>
<li>Empty tags <code>&lt;line-break /&gt;</code></li>
</ul></li>
<li>Elements are specific examples of tags
<ul>
<li><code>&lt;name&gt;Belgian Waffles&lt;/name&gt;</code></li>
</ul></li>
<li>Attributes are components of the label
<ul>
<li><code>&lt;book category=&quot;web&quot;&gt;</code></li>
</ul></li>
</ul>
<p>許多Open Data也用XML格式儲存，例如<a href="http://data.taipei/opendata/datalist/datasetMeta/download?id=961ca397-4a59-45e8-b312-697f26b059dc&amp;rid=190796c8-7c56-42e0-8068-39242b8ec927" target="_blank">臺北市水質監測資訊</a>。如需將XML檔案匯入R中，需要安裝<code>XML</code> <span class="citation">(Temple Lang and CRAN Team <a href="#ref-R-XML">2016</a>)</span> package，使用<code>xmlParse()</code>函數將檔案匯入。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(XML)
waterQ &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(<span class="st">&quot;http://data.taipei/opendata/datalist/datasetMeta/download?id=961ca397-4a59-45e8-b312-697f26b059dc&amp;rid=190796c8-7c56-42e0-8068-39242b8ec927&quot;</span>)</code></pre></div>
<p>使用<code>xpathSApply()</code>函數取得指定標籤內的資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#取得所有&quot;code_name&quot;標籤內的資料</span>
<span class="kw">xpathSApply</span>(waterQ,<span class="st">&quot;//code_name&quot;</span>,xmlValue)[<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>##  [1] &quot;雙溪淨水場&quot;               &quot;衛理女中&quot;                
##  [3] &quot;雙溪國小                &quot; &quot;華興加壓站&quot;              
##  [5] &quot;長興淨水場&quot;               &quot;市政大樓&quot;                
##  [7] &quot;市議會&quot;                   &quot;捷運忠孝復興站&quot;          
##  [9] &quot;南港高工&quot;                 &quot;南港加壓站&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#取得各監測站的經度</span>
<span class="kw">xpathSApply</span>(waterQ,<span class="st">&quot;//longitude&quot;</span>,xmlValue)[<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>##  [1] &quot;121.56094&quot; &quot;121.54401&quot; &quot;121.55557&quot; &quot;121.53476&quot; &quot;121.54043&quot; &quot;121.55661&quot;
##  [7] &quot;121.55360&quot; &quot;121.53551&quot; &quot;121.59892&quot; &quot;121.60829&quot;</code></pre>
</div>
<div id="-webscraping" class="section level3">
<h3><span class="header-section-number">5.2.5</span> 網頁爬蟲 Webscraping</h3>
<p>由於不是每個網站都提供API，但網頁上卻有你想要分析的資料（像是ptt推文！？），除了人工複製貼上以外，也可以將網頁處理程式化，以程式化的方式擷取網頁資料就叫做<strong>網頁爬蟲（Webscraping）</strong>（<a href="http://en.wikipedia.org/wiki/Web_scraping" target="_blank">Webscraping Wiki</a>）。在R中可以直接把HTML檔案當作XML檔案處理分析，也可使用<code>rvest</code><span class="citation">(Wickham <a href="#ref-R-rvest">2016</a><a href="#ref-R-rvest">c</a>)</span> package輔助爬蟲程式撰寫。</p>
<p>此外，網頁爬蟲可能耗費很多網頁流量和資源，所以在許多網站被視為非法行為，如果一次讀太多太快，很可能被鎖IP。</p>
<p>以<a href="http://im.cgu.edu.tw/bin/home.php" target="_blank">長庚資管系</a>網站為例，可直接逐行讀取 <code>readLines()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">con &lt;-<span class="st"> </span><span class="kw">url</span>(<span class="st">&quot;http://im.cgu.edu.tw/bin/home.php&quot;</span>)
htmlCode &lt;-<span class="kw">readLines</span>(con)</code></pre></div>
<pre><code>## Warning in readLines(con): incomplete final line found on &#39;http://im.cgu.edu.tw/
## bin/home.php&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">close</span>(con)
htmlCode[<span class="dv">1</span>:<span class="dv">5</span>]</code></pre></div>
<pre><code>## [1] &quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD XHTML 1.0 Transitional//EN\&quot; \&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\&quot;&gt;&quot;                
## [2] &quot;&lt;html xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; lang=\&quot;zh-tw\&quot;&gt;&quot;                                                                                 
## [3] &quot;&lt;head&gt;&quot;                                                                                                                                       
## [4] &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt;&quot;                                                                    
## [5] &quot;&lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=EmulateIE7\&quot; /&gt;&lt;meta name=\&quot;keywords\&quot; content=\&quot;請填寫網站關鍵記事，用半角逗號(,)隔開\&quot; /&gt;&quot;</code></pre>
<p>讀取完網頁後，使用用XML工具分析擷取網頁 (<code>XML</code> package)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(httr)
html &lt;-<span class="st"> </span><span class="kw">htmlParse</span>(<span class="kw">GET</span>(<span class="st">&quot;http://im.cgu.edu.tw/bin/home.php&quot;</span>))</code></pre></div>
<pre><code>## No encoding supplied: defaulting to UTF-8.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xpathSApply</span>(html, <span class="st">&quot;//title&quot;</span>, xmlValue)</code></pre></div>
<pre><code>## [1] &quot;長庚大學 資訊管理學系 &quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xpathSApply</span>(html, <span class="st">&quot;//span[@class=&#39;ptname &#39;]&quot;</span>, xmlValue)</code></pre></div>
<pre><code>##  [1] &quot;畢業專題成果展&quot;       &quot;碩士班計畫書審查&quot;     &quot;畢業校友資料登錄&quot;    
##  [4] &quot;長庚大學首頁&quot;         &quot;校務資訊系統&quot;         &quot;人事教育訓練資訊網&quot;  
##  [7] &quot;資管系導師名單&quot;       &quot;TA課後輔導值班表&quot;     &quot;碩博士論文網&quot;        
## [10] &quot;國內資管系所&quot;         &quot;資管系內部行政系統&quot;   &quot;資管系分機表&quot;        
## [13] &quot;資管系學會&quot;           &quot;工商管理學系/研究所&quot;  &quot;工業設計學系/研究所&quot; 
## [16] &quot;管理學院&quot;             &quot;醫務管理學系/研究所&quot;  &quot;商管專業學院&quot;        
## [19] &quot;企業管理研究所博士班&quot; &quot;長庚大學行事曆&quot;</code></pre>
<p>除了把HTML檔案當作XML處理外，<code>rvest</code><span class="citation">(Wickham <a href="#ref-R-rvest">2016</a><a href="#ref-R-rvest">c</a>)</span> package是R語言中最常被使用的爬蟲套件，使用前一樣需要安裝與載入</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;rvest&quot;</span>) ##安裝</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest) ##載入</code></pre></div>
<p>載入<code>rvest</code>套件後，經由以下步驟進行網站解析：</p>
<ul>
<li>使用<code>read_html(“欲擷取的網站網址”)</code>函數讀取網頁</li>
<li>使用<code>html_nodes()</code>函數擷取所需內容 (條件為CSS或xpath標籤)</li>
<li>使用<code>html_text()</code>函數處理/清洗擷取內容，留下需要的資料</li>
<li>使用<code>html_attr()</code>函數擷取資料參數（如連結url）</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">YahooNewsurl=<span class="st">&quot;https://tw.news.yahoo.com/&quot;</span>
news_title =<span class="st"> </span><span class="kw">read_html</span>(YahooNewsurl) %&gt;%<span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.tpl-title a&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">html_text</span>()
news_url =<span class="st"> </span><span class="kw">read_html</span>(YahooNewsurl) %&gt;%<span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.tpl-title a&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)
Yahoo_news =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">title =</span> news_title, <span class="dt">url=</span>news_url)
<span class="kw">head</span>(Yahoo_news)</code></pre></div>
<pre><code>                                    title                                                           url
1         曾1妻5妾好風光 男星慘賣豪宅還債 /從1妻5妾的風光到變賣豪宅還債-網友噓雷洪：活該-091741737.html
2          美報告：美棄「一中」台灣更危險               /美報告-美拋棄-中-台灣處境更危險-081036215.html
3           藍色凍蕃薯！1張圖看寒流有多冷       /霸王級寒流再襲台-張圖看懂這波寒流有多強-101500692.html
4           他被妻子戴綠帽 對象竟是親弟弟                 /他被妻子戴綠帽-對象竟是親弟弟-072010033.html
5               匆忙推出移民禁令 他後悔了           /匆忙推移民禁令-美國土安全部長表後悔-044517088.html
6 蔡政府對釣魚台態度 國民黨憂美日安保質變       /蔡政府對釣魚台態度-國民黨憂美日安保質變-160200179.html</code></pre>
<p>在<code>html_nodes()</code>、<code>html_text()</code>和<code>html_attr()</code>函數中，擷取條件的撰寫會因網頁語法不同而有差異，必須要使用<strong>Google Chrome開發工具</strong>等工具輔助觀察需要擷取資料的條件。以上述Yahoo新聞為例，需要擷取的資料所在HTML片段如下：</p>
<pre><code>&lt;ul class=&quot;tpl-title yom-list list-style-none&quot; id=&quot;yui_3_9_1_1_1486568229946_2408&quot;&gt;
&lt;li class=&quot;list-story first&quot; id=&quot;yui_3_9_1_1_1486568229946_2407&quot;&gt;
&lt;div class=&quot;txt&quot; id=&quot;yui_3_9_1_1_1486568229946_2406&quot;&gt;
&lt;a href=&quot;/從1妻5妾的風光到變賣豪宅還債-網友噓雷洪：活該-091741737.html&quot; class=&quot;title &quot; data-ylk=&quot;pkg:96a0ca11-47bc-3100-81ad-0a288707f150;ver:60cdb126-ee0c-11e6-bb9b-8a777738a932;lt:i;pos:1;&quot; data-rapid_p=&quot;1&quot;&gt;曾1妻5妾好風光 男星慘賣豪宅還債&lt;/a&gt;
&lt;cite id=&quot;yui_3_9_1_1_1486568229946_2405&quot;&gt;
&lt;span class=&quot;provider&quot; id=&quot;yui_3_9_1_1_1486568229946_2404&quot;&gt;Yahoo奇摩娛樂新聞&lt;/span&gt;
&lt;/cite&gt;&lt;/div&gt;&lt;/li&gt;
....</code></pre>
<p>觀察上述程式碼可已發現新聞清單被包含在<code>ul</code>標籤下，且css class為<code>tpl-title yom-list list-style-none</code>，所以這邊可以使用第一個class<code>tpl-title</code>為篩選條件。網頁爬蟲需要多做觀察與練習，才可熟知篩選技巧。</p>
<p>其他爬蟲相關參考資源:</p>
<ul>
<li><a href="https://www.slideshare.net/secret/mdfHLPgvIW1kPR" target="_blank">網路爬蟲實作 - 用 r 語言打造自己的爬蟲程式</a></li>
<li><a href="https://github.com/hadley/rvest" target="_blank">rvest GitHub</a></li>
<li>R Bloggers 有很多<a href="http://www.r-bloggers.com/?s=Web+Scraping" target="_blank">爬蟲範例</a>（英文）</li>
<li><a href="http://bryannotes.blogspot.tw/2014/08/r-ptt-wantedsocial-network-analysis.html" target="_blank">Ptt爬蟲實作</a></li>
<li><a href="http://www.largitdata.com/course_list/1" target="_blank">大數學堂 網頁爬蟲課程</a></li>
</ul>
</div>
</div>
<div id="facebook" class="section level2">
<h2><span class="header-section-number">5.3</span> Facebook資料擷取</h2>
<p>Facebook提供<a href="https://developers.facebook.com/docs/graph-api?locale=zh_TW" target="_blank">Graph API</a>，讓應用程式可透過API讀取與寫入 Facebook相關資料，<strong>Graph API</strong>會根據篩選條件，回傳JSON格式的資料。除此之外，Facebook還提供<a href="https://developers.facebook.com/tools/explorer/" target="_blank">Graph API Explorer</a>，讓程式開發人員可以測試資料撈取方法和結果。 在開始使用<strong>Graph API</strong>之前，必須要取得自己的<strong>access token</strong> (存取權杖)，<a href="https://developers.facebook.com/tools/explorer/" target="_blank">Graph API Explorer</a>工具提供<strong>Get Token</strong>按鈕(通常在視窗右上角)，可以讓開發者在不用新增應用程式(Application)的情況下取得暫時的<strong>access token</strong>。</p>
<p>有關Facebook access token的詳細介紹，可參考<a href="https://developers.facebook.com/docs/facebook-login/access-tokens/?locale=zh_TW" target="_blank">官方文件</a></p>
<div id="graph-api-in-r" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Graph API in R</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(httr)
token&lt;-<span class="st">&quot;your token&quot;</span> <span class="co">#將access token複製到此處 </span>
FBData =<span class="st"> </span><span class="kw">GET</span>(
    <span class="kw">paste0</span>(<span class="st">&quot;https://graph.facebook.com/v2.8/tsaiingwen?fields=posts%7Bmessage%7D&amp;access_token=&quot;</span>,
           token))
<span class="kw">names</span>(FBData)</code></pre></div>
<pre><code>## [1] &quot;url&quot;         &quot;status_code&quot; &quot;headers&quot;     &quot;all_headers&quot; &quot;cookies&quot;     &quot;content&quot;     &quot;date&quot;       
## [8] &quot;times&quot;       &quot;request&quot;     &quot;handle&quot;    </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">json1 =<span class="st"> </span><span class="kw">content</span>(FBData)
<span class="kw">names</span>(json1)</code></pre></div>
<pre><code>## [1] &quot;posts&quot; &quot;id&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(json1$posts)</code></pre></div>
<pre><code>## [1] &quot;data&quot;   &quot;paging&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(json1$posts$data,<span class="dv">3</span>)</code></pre></div>
<pre><code>[[1]]
[[1]]$message
[1] &quot;「國機國造」不是夢想，而是一個行動。今天啟動的高級教練機「自研自製」任務，是國防自主的重要里程碑。我們不只要讓戰機起飛，更要讓產業起飛。\n\n國防產業同樣是「5+2」關鍵產業之一，所以，除了要如期、如質完成新式高教機的「自研自製」外，也要重新厚植台灣的航太工業人才鏈，以及加強相關產業的連結、轉型和升級。\n\n國防自主沒有捷徑，只有努力再努力、堅持再堅持。今天，我們重新跨出歷史性的一步。&quot;

[[1]]$id
[1] &quot;46251501064_10154006497451065&quot;


[[2]]
[[2]]$message
[1] &quot;今天，智慧機械推動辦公室正式啟動。「落實產學合作」、「支持創新研發」、「強化行銷通路」是辦公室的三項重點任務。\n\n智慧機械是「5+2」關鍵產業的其中之一。政府有決心。我相信，所有的機械業者－無論做的是螺桿、刀庫、控制器或是工作母機，大家也都有很強的決心，要走向創新、走向智慧化、走向品牌。我們是一個團隊，我們一起加油！&quot;

[[2]]$id
[1] &quot;46251501064_10154006456601065&quot;


[[3]]
[[3]]$message
[1] &quot;今天來向台商拜個晚年。我也邀請台商朋友們，共同參與台灣經濟轉型升級的世紀工程。\n\n無論是擴大對國內的投資，或者配合新南向政策，前進海外深耕佈局，我期待跟台商朋友們一起努力，群策群力，克服困難和瓶頸，為台灣經濟發展打開全新的局面。&quot;

[[3]]$id
[1] &quot;46251501064_10154001652641065&quot;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">json1$posts$data[[<span class="dv">1</span>]]$message</code></pre></div>
<pre><code>##[1] &quot;「國機國造」不是夢想，而是一個行動。今天啟動的高級教練機「自研自製」任務，是國防自主的重要里程碑。我們不只要讓戰機起飛，更要讓產業起飛。\n\n國防產業同樣是「5+2」關鍵產業之一，所以，除了要如期、如質完成新式高教機的「自研自製」外，也要重新厚植台灣的航太工業人才鏈，以及加強相關產業的連結、轉型和升級。\n\n國防自主沒有捷徑，只有努力再努力、堅持再堅持。今天，我們重新跨出歷史性的一步。&quot;</code></pre>
</div>
<div id="rfacebook-package" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Rfacebook package</h3>
<p>除了直接使用Graph API外，也可使用<code>Rfacebook</code><span class="citation">(Barbera, Piccirilli, and Geisler <a href="#ref-R-Rfacebook">2017</a>)</span> package來讀取Facebook資料。 以下為使用Rfacebook取得 <code>tsaiingwen</code> 粉絲頁的資料範例：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Rfacebook)
token&lt;-<span class="st">&quot;your token&quot;</span> <span class="co">#將token複製到此處 </span>
<span class="kw">getPage</span>(<span class="st">&quot;tsaiingwen&quot;</span>, token,<span class="dt">n =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>5 posts       from_id           from_name
1 46251501064 蔡英文 Tsai Ing-wen
2 46251501064 蔡英文 Tsai Ing-wen
3 46251501064 蔡英文 Tsai Ing-wen
4 46251501064 蔡英文 Tsai Ing-wen
5 46251501064 蔡英文 Tsai Ing-wen
                                                                                                                                                                                                                                                                                                                                                                                        message
1 「國機國造」不是夢想，而是一個行動。今天啟動的高級教練機「自研自製」任務，是國防自主的重要里程碑。我們不只要讓戰機起飛，更要讓產業起飛。\n\n國防產業同樣是「5+2」關鍵產業之一，所以，除了要如期、如質完成新式高教機的「自研自製」外，也要重新厚植台灣的航太工業人才鏈，以及加強相關產業的連結、轉型和升級。\n\n國防自主沒有捷徑，只有努力再努力、堅持再堅持。今天，我們重新跨出歷史性的一步。
2                                                                   今天，智慧機械推動辦公室正式啟動。「落實產學合作」、「支持創新研發」、「強化行銷通路」是辦公室的三項重點任務。\n\n智慧機械是「5+2」關鍵產業的其中之一。政府有決心。我相信，所有的機械業者－無論做的是螺桿、刀庫、控制器或是工作母機，大家也都有很強的決心，要走向創新、走向智慧化、走向品牌。我們是一個團隊，我們一起加油！
3                                                                                                                                                          今天來向台商拜個晚年。我也邀請台商朋友們，共同參與台灣經濟轉型升級的世紀工程。\n\n無論是擴大對國內的投資，或者配合新南向政策，前進海外深耕佈局，我期待跟台商朋友們一起努力，群策群力，克服困難和瓶頸，為台灣經濟發展打開全新的局面。
4                                                                                                                                                                                                                                                                                    「快了」！雞年通機捷，等待很值得。大年初四，我來看看機場捷運通車前的準備，也坐捷運到中壢，跟鄉親拜年問好。
5                                                                                                                                                                                                                                                                                                            雞年初三發福袋\n\n臺中豐原慈濟宮、彰化溪湖福安宮、雲林北港朝天宮、嘉義九華山地藏庵
              created_time  type
1 2017-02-07T08:02:45+0000 photo
2 2017-02-07T07:18:00+0000 photo
3 2017-02-05T07:12:52+0000 photo
4 2017-01-31T08:37:42+0000 photo
5 2017-01-30T11:41:07+0000 photo
                                                                                                    link
1 https://www.facebook.com/tsaiingwen/photos/a.390960786064.163647.46251501064/10154006497206065/?type=3
2 https://www.facebook.com/tsaiingwen/photos/a.390960786064.163647.46251501064/10154006455396065/?type=3
3 https://www.facebook.com/tsaiingwen/photos/a.390960786064.163647.46251501064/10154001652641065/?type=3
4 https://www.facebook.com/tsaiingwen/photos/a.390960786064.163647.46251501064/10153989357181065/?type=3
5 https://www.facebook.com/tsaiingwen/photos/a.390960786064.163647.46251501064/10153987089121065/?type=3
                             id likes_count comments_count shares_count
1 46251501064_10154006497451065        2013            125           43
2 46251501064_10154006456601065        2217            163           57
3 46251501064_10154001652641065        9416            920          163
4 46251501064_10153989358051065       34116           1574          373
5 46251501064_10153987095776065       20592            665          269</code></pre>
<p>由於每次擷取資料的比數有上限（大概是30筆左右），如果需要取得更多更長期的資料，就要使用迴圈協助，分批取得資料，透過設定 <strong>since</strong> 和 <strong>until</strong>參數，可設定資料擷取區間。</p>
<p>首先先取得日期向量，供後續迴圈做使用</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lastDate&lt;-<span class="kw">Sys.Date</span>()
DateVector&lt;-<span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2017-01-01&quot;</span>),lastDate,<span class="dt">by=</span><span class="st">&quot;5 days&quot;</span>)
DateVectorStr&lt;-<span class="kw">as.character</span>(DateVector)
DateVectorStr</code></pre></div>
<pre><code>## &quot;2017-01-01&quot; &quot;2017-01-06&quot; &quot;2017-01-11&quot; &quot;2017-01-16&quot; &quot;2017-01-21&quot; &quot;2017-01-26&quot; &quot;2017-01-31&quot; &quot;2017-02-05&quot;</code></pre>
<p>利用上述日期向量資料，搭配迴圈，依序設定<strong>since</strong> 和 <strong>until</strong>參數</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">totalPage&lt;-<span class="ot">NULL</span>
token&lt;-<span class="st">&#39;your token&#39;</span>
numberOfPost&lt;-<span class="dv">30</span>
for(i in <span class="dv">1</span>:(<span class="kw">length</span>(DateVectorStr)-<span class="dv">1</span>)){
    tempPage&lt;-<span class="kw">getPage</span>(<span class="st">&quot;tsaiingwen&quot;</span>, token,
                      <span class="dt">since =</span> DateVectorStr[i],<span class="dt">until =</span> DateVectorStr[i<span class="dv">+1</span>])
    totalPage&lt;-<span class="kw">rbind</span>(totalPage,tempPage)
}
<span class="kw">nrow</span>(totalPage)</code></pre></div>
<pre><code>## 4 posts 8 posts 10 posts 3 posts 2 posts 14 posts 1 posts
## [1] 42</code></pre>
<p>Rfacebook Packages提供其他函數可供使用</p>
<ul>
<li>getUser()</li>
<li>getPost()</li>
<li>getLikes()</li>
<li>Check <a href="https://github.com/pablobarbera/Rfacebook" class="uri">https://github.com/pablobarbera/Rfacebook</a></li>
<li>?Rfacebook</li>
</ul>
</div>
</div>
<div id="section-5.4" class="section level2">
<h2><span class="header-section-number">5.4</span> 資料匯出</h2>
<p>在R中完成資料處理後，有多種匯出選擇，如果是要匯出供他人在其他環境(如Excel)使用，建議匯出成tab分隔的文字檔(.txt)或是逗號分隔的文字檔(.csv)；但若是要在R的環境繼續使用，建議匯出成R物件 (.rds)，除了可保留欄位型別設定外，讀取速度與檔案大小皆優於文字檔案。</p>
<div id="-.txt" class="section level3">
<h3><span class="header-section-number">5.4.1</span> 文字檔 .txt</h3>
<p>使用<code>write.table()</code>函數寫入檔案，需要參數有</p>
<ul>
<li><code>x</code> 要匯出的檔案，通常為matrix或是data.frame格式</li>
<li><code>file</code> 檔案名稱</li>
<li><code>append</code> T/F TRUE表示在檔案後端加入文字，F表示直接覆蓋原始檔案 (預設F)</li>
<li><code>quote</code> 是否需要用雙引號將字串包起 (預設T)</li>
<li><code>sep</code> 分隔符號 (預設空白)</li>
<li><code>eol</code> 換行符號</li>
<li><code>na</code> 表示空值的字串</li>
<li><code>dec</code> 小數點表示法</li>
<li><code>row.names</code> T/F 是否需要輸出row names</li>
<li><code>col.names</code> T/F 是否需要輸出column names</li>
<li><code>qmethod</code> 逃脫字串設定</li>
<li><code>fileEncoding</code> 編碼設定</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.table</span>(iris,<span class="dt">file=</span><span class="st">&quot;iris.txt&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,<span class="dt">row.names =</span> F,<span class="dt">col.names =</span> T)</code></pre></div>
</div>
<div id="csv-.csv" class="section level3">
<h3><span class="header-section-number">5.4.2</span> CSV檔 .csv</h3>
<p>與<code>write.table()</code>類似，使用<code>write.csv()</code>函數寫入檔案</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(iris,<span class="dt">file=</span><span class="st">&quot;iris.csv&quot;</span>,<span class="dt">row.names =</span> F)</code></pre></div>
</div>
<div id="r-.rds-1" class="section level3">
<h3><span class="header-section-number">5.4.3</span> R物件 .rds</h3>
<p>若是要在R的環境繼續使用，建議匯出成R物件檔案(.rds)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(iris,<span class="st">&quot;iris.rds&quot;</span>)</code></pre></div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-readr">
<p>Wickham, Hadley, Jim Hester, and Romain Francois. 2016. <em>Readr: Read Tabular Data</em>. <a href="https://CRAN.R-project.org/package=readr" class="uri">https://CRAN.R-project.org/package=readr</a>.</p>
</div>
<div id="ref-R-readxl">
<p>Wickham, Hadley. 2016a. <em>Readxl: Read Excel Files</em>. <a href="https://CRAN.R-project.org/package=readxl" class="uri">https://CRAN.R-project.org/package=readxl</a>.</p>
</div>
<div id="ref-R-jsonlite">
<p>Ooms, Jeroen, Duncan Temple Lang, and Lloyd Hilaiel. 2016. <em>Jsonlite: A Robust, High Performance Json Parser and Generator for R</em>. <a href="https://CRAN.R-project.org/package=jsonlite" class="uri">https://CRAN.R-project.org/package=jsonlite</a>.</p>
</div>
<div id="ref-R-RCurl">
<p>Temple Lang, Duncan, and the CRAN team. 2016. <em>RCurl: General Network (Http/Ftp/.) Client Interface for R</em>. <a href="https://CRAN.R-project.org/package=RCurl" class="uri">https://CRAN.R-project.org/package=RCurl</a>.</p>
</div>
<div id="ref-R-XML">
<p>Temple Lang, Duncan, and the CRAN Team. 2016. <em>XML: Tools for Parsing and Generating Xml Within R and S-Plus</em>. <a href="https://CRAN.R-project.org/package=XML" class="uri">https://CRAN.R-project.org/package=XML</a>.</p>
</div>
<div id="ref-R-rvest">
<p>Wickham, Hadley. 2016c. <em>Rvest: Easily Harvest (Scrape) Web Pages</em>. <a href="https://CRAN.R-project.org/package=rvest" class="uri">https://CRAN.R-project.org/package=rvest</a>.</p>
</div>
<div id="ref-R-Rfacebook">
<p>Barbera, Pablo, Michael Piccirilli, and Andrew Geisler. 2017. <em>Rfacebook: Access to Facebook Api via R</em>. <a href="https://CRAN.R-project.org/package=Rfacebook" class="uri">https://CRAN.R-project.org/package=Rfacebook</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="function.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="manipulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "Microsoft JhengHei",
"size": 2
},
"edit": {
"link": "https://github.com/yijutseng/DataAnalyticsWithRBook/edit/master/05-io.Rmd",
"text": "Edit"
},
"download": ["DataAnalyticsWithR.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
